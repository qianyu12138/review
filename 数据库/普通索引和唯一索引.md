# 普通索引和唯一索引

极客时间09

### 读取操作

innodb的数据是以数据页为单位进行读写的。默认是16k。

- 对于普通索引，查找到满足条件的一条记录后，需要查找下一条记录，直到遇到不满足条件的记录为止。
- 对于唯一索引，查找到满足条件的记录后返回。

对于满足唯一条件的普通索引和唯一索引，只相差查找下一条记录的操作，都是在内存中一个数据页内完成的，只需要一次指针寻找和一次计算。

### 更新操作

#### change buffer

使用buffer pool内存空间，通过innodb_change_buffer_max_size占用buffer pool百分比。

**原理**：当更新一条数据时，如果数据页在内存中就直接更新，如果不在，将这些更新操作缓存在change buffer中，这样就不需要将数据页从磁盘中读出来。在下次需要访问这个数据页时，将数据页读到内存后，执行change buffer中的操作（merge）。

可持久化ibdata

作用：减少读磁盘，提升语句执行速度，节省内存（page）

##### 什么时候可以使用change buffer

对于唯一索引来说，每次更新（insert、update）都需要判定唯一性约束，需要将page读到内存中，没必要使用change buffer。所以只有普通索引能用。

**普通索引和唯一索引对比来看，如果数据页已经在内存中，那么两者相差不大；如果不在，普通索引使用change buffer唯一索引更新需要读入page，性能较低。**

#### 使用场景

不是所有的普通索引都适用。

对于写多读少，change buffer中的操作积累的越多，对于性能提升越大。而如果写入后马上进行查询，merge只有一次操作，没意义，反而增加change buffer维护代价。这种情况应关闭change buffer。

而对于历史数据这种库，很少进行查询，那么应该使用普通索引，并把change buffer尽量开大。

### 与redo log作用比较

redo log主要节省随机写磁盘的IO消耗（转换成顺序写），change buffer主要节省随机读磁盘的IO消耗。